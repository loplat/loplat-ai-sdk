(function(){"use strict";const d=(e="loplat-new-ai-btn")=>{const t=document.createElement("button");return t.id=e,t},h=(e="loplat-new-ai-popup",t="http://localhost:5001/")=>{const n=document.createElement("div");return n.id=e,n.innerHTML=`
      <iframe
        src=${t}
        class="loplat-new-ai"
      >
      </iframe>
  `,n},r=()=>{const e=d(),t=h();document.body.appendChild(e),document.body.appendChild(t);let n=!1;e.addEventListener("click",()=>{t.style.display=n?"none":"block",window.dispatchEvent(new Event("popstate")),n=!n}),window.addEventListener("popstate",()=>{var a;const i=window.location.href,o=t.querySelector("iframe");o&&((a=o.contentWindow)==null||a.postMessage({type:"URL_CHANGE",url:i},"*"))});const s=history.pushState;history.pushState=function(...i){s.apply(this,i),arguments[0].isReplace||window.dispatchEvent(new Event("popstate"))};const l=history.replaceState;history.replaceState=function(...i){arguments[0].isReplace=!0,l.apply(this,i)},window.addEventListener("message",i=>{const{data:o}=i;"type"in o&&o.type==="highlight"&&"value"in o&&window.ChatWidget.highlightText(`${i.data.value}`)})},u=e=>{document.querySelectorAll(`.${e}`).forEach(n=>{const s=n.parentElement;s&&s.replaceChild(document.createTextNode(n.textContent||""),n)})},c=(e,t,n)=>{if(e.nodeType===Node.ELEMENT_NODE&&e.nodeName!=="SCRIPT"&&e.nodeName!=="STYLE")return Array.from(e.childNodes).forEach(a=>c(a,t,n));if(!(e.nodeType===Node.TEXT_NODE&&!!e.nodeValue))return;const i=e.nodeValue??"",o=e.parentElement;if(i.includes(t)&&o){const a=new RegExp(`(${t})`,"gi"),E=i.replace(a,`<span class="${n}">$1</span>`),p=document.createElement("span");p.innerHTML=E,o.replaceChild(p,e)}},g=(e,t="highlight")=>{e&&(u(t),c(document.body,e,t))};window.ChatWidget={init:r,highlightText:g},r()})();
