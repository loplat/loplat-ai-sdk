(function(){"use strict";const m=(t="loplat-new-ai-btn")=>{const n=document.createElement("button");return n.id=t,n},f=(t="loplat-new-ai-popup",n="https://cheery-florentine-ca54ac.netlify.app/")=>{const e=document.createElement("div");return e.id=t,e.innerHTML=`
      <iframe
        src=${n}
        class="loplat-new-ai"
      >
      </iframe>
  `,e},c="highlight-visible",p=()=>{const t=new IntersectionObserver(e=>{e.forEach(o=>{const s=o.target;o.isIntersecting?s.classList.add(c):s.classList.remove(c)})},{root:null,rootMargin:"0px",threshold:.5}),n=e=>{e.nodeType===Node.ELEMENT_NODE&&e.nodeName!=="SCRIPT"&&e.nodeName!=="STYLE"?Array.from(e.childNodes).forEach(n):e.parentElement&&t.observe(e.parentElement)};n(document.body)},l=({popup:t,type:n,...e})=>{var s;const o=t.querySelector("iframe");o&&((s=o.contentWindow)==null||s.postMessage({type:n,value:e},"*"))},E=t=>l({popup:t,type:"URL_CHANGE",url:window.location.href}),w=t=>{const{data:n}=t;typeof n!="object"||n===null||!("type"in n&&n.type==="HIGHLIGHT")||window.ChatWidget.highlightText({keyword:`${t.data.value.keyword}`,nth:Number(t.data.value.nth??1)})},N=(t,n)=>{const e=t.target;if(!e)return;const o={x:t.clientX,y:t.clientY};if(!(e instanceof HTMLElement))return l({popup:n,type:"MOUSE_CLICK",...o});const s=e.tagName,a=e.id?`#${e.id}`:"",g=e.className?`.${e.className.split(" ").filter(r=>r!==c).join(".")}`:"",i=`${s}${a}${g}`;return l({popup:n,type:"MOUSE_CLICK",...o,tagPath:i,tagContent:e.innerText})},h=()=>{const t=m(),n=f();document.body.appendChild(t),document.body.appendChild(n);let e=!1;t.addEventListener("click",()=>{n.style.display=e?"none":"block",window.dispatchEvent(new Event("popstate")),e=!e});const o=history.pushState;history.pushState=function(...a){o.apply(this,a),arguments[0].isReplace||window.dispatchEvent(new Event("popstate"))};const s=history.replaceState;history.replaceState=function(...a){arguments[0].isReplace=!0,s.apply(this,a)},window.addEventListener("popstate",()=>E(n)),window.addEventListener("message",w),window.addEventListener("click",a=>N(a,n)),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p()},y=t=>{document.querySelectorAll(`.${t}`).forEach(e=>{const o=e.parentElement;o&&o.replaceChild(document.createTextNode(e.textContent||""),e)})},u=({node:t,keyword:n,currentIdx:e={value:1},targetIdx:o,highlightClass:s})=>{if(t.nodeType===Node.TEXT_NODE&&!!t.nodeValue){const i=t.nodeValue??"",r=t.parentElement;if(i.includes(n)&&r){if(e.value===o){const T=new RegExp(`(${n})`,"gi"),L=i.replace(T,`<span class="${s}">$1</span>`),d=document.createElement("span");d.innerHTML=L,r.replaceChild(d,t);const C=d.getBoundingClientRect();window.scrollTo({top:C.top+window.scrollY-200,behavior:"smooth"})}e.value+=1}}t.nodeType===Node.ELEMENT_NODE&&t.nodeName!=="SCRIPT"&&t.nodeName!=="STYLE"&&Array.from(t.childNodes).forEach(i=>u({node:i,keyword:n,currentIdx:e,targetIdx:o,highlightClass:s}))},v=({keyword:t,nth:n=1,highlightClass:e="highlight"})=>{t&&(y(e),u({node:document.body,keyword:t,targetIdx:n,highlightClass:e}))};window.ChatWidget={init:h,highlightText:v},h()})();
